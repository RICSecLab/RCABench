#!/bin/bash
. ${TARGET_ROOT}/config.sh

if [ $# -lt 1 ]; then
  echo "Usage: $0 <build dir name>" 1>&2
  exit 1
fi

cd ${TARGET_ROOT}
git clone https://gitlab.gnome.org/GNOME/libxml2.git $1
cd ${TARGET_ROOT}/$1
git checkout 362b3229

TARGET_DEF_CFLAGS="${TARGET_DEF_CFLAGS-} -static"
TARGET_DEF_CXXFLAGS="${TARGET_DEF_CXXFLAGS-} -static"

./autogen.sh

ARGS=""
for var in "${!TARGET_DEF_@}"; do
  ARGS="${ARGS} ${var#TARGET_DEF_}=\"$(echo ${!var})\""
done
eval make ${ARGS} -j$(nproc)
