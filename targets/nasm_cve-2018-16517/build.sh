#!/bin/bash

cd $TARGET_ROOT

. ${TARGET_ROOT}/config.sh

git clone --branch nasm-2.14rc15 --depth 1 https://github.com/netwide-assembler/nasm.git $1
cd ${TARGET_ROOT}/$1
sh autogen.sh

TARGET_DEF_CFLAGS="${TARGET_DEF_CFLAGS-} "
TARGET_DEF_CXXFLAGS="${TARGET_DEF_CXXFLAGS-} "
ARGS=""
for var in "${!TARGET_DEF_@}"; do
  ARGS="${ARGS} ${var#TARGET_DEF_}=\"$(echo ${!var})\""
done

eval ./configure  'CFLAGS="-static -static-libasan"'

eval make ${ARGS} -j$(nproc) nasm

#set +e
#./nasm -f elf ../poc
