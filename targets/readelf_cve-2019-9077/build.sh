#!/bin/bash
set -eu

. ${TARGET_ROOT}/config.sh

build_module () {
  pushd $1

  ./configure

  ARGS=""
  for var in "${!TARGET_DEF_@}"; do
    ARGS="${ARGS} ${var#TARGET_DEF_}=\"$(echo ${!var})\""
  done
  eval make ${ARGS} -j$((`nproc`+1))
  popd
}

cd $TARGET_ROOT

# a9d9a104dde6a749f40ce5c4576a0042a7d52d1f
git clone --branch binutils-2_32 --depth 1 git://sourceware.org/git/binutils-gdb.git $1
cd $TARGET_ROOT/$1

build_module bfd
build_module libiberty
build_module opcodes
build_module binutils
